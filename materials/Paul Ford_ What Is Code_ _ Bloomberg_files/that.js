!function(){"use strict";var That={selectors:{container:"#bb-that--container",header:".bb-that-header",jumpContentLink:".skiplink__hide-until-focus",jumpContentLinkFallback:".bb-that__skip-to-content",jumpContentTarget:"#that-jump-content",jumpContentTargetFallback:"#that-jump-content--default",mobileCategories:".bb-that--visible-xs .bb-that-category:not(.bb-that-category--sub) .bb-that-category__title",sitemapClose:".bb-that__close",sitemapLink:".bb-that-header--sitemap-trigger",tabbableHeaderLinks:".bb-that-header__link",tabbableSitemapLinks:'[tabindex="0"]',wrapper:"#bb-that .bb-that:not(.bb-that--static)"},alertEvent:"bloomberg.that.alert",containerEl:null,headerEl:null,jumpContentLinkFallback:null,jumpContentTarget:null,openClass:"bb-that--open",sitemapCloseEl:null,sitemapLinkEl:null,sitemapLinkSibEl:null,sitemapOpen:!1,tabbableHeaderLinks:null,tabbableSitemapLinks:null,wrapperEl:null,init:function(){this.wrapperEl=document.querySelector(this.selectors.wrapper),null!==this.wrapperEl&&(this.containerEl=this.wrapperEl.querySelector(this.selectors.container),this.sitemapLinkEl=this.wrapperEl.querySelector(this.selectors.sitemapLink),this.sitemapCloseEl=this.wrapperEl.querySelector(this.selectors.sitemapClose),this.headerEl=this.wrapperEl.querySelector(this.selectors.header),this.sitemapLinkSibEl=this.getNextSibling(this.sitemapLinkEl),this.tabbableHeaderLinks=Array.prototype.slice.call(document.querySelectorAll(this.selectors.tabbableHeaderLinks)),this.tabbableSitemapLinks=Array.prototype.slice.call(this.containerEl.querySelectorAll(this.selectors.tabbableSitemapLinks)),this.jumpContentLink=document.querySelector(this.selectors.jumpContentLink),this.jumpContentLinkFallback=this.wrapperEl.querySelector(this.selectors.jumpContentLinkFallback),this.jumpContentTarget=document.querySelector(this.selectors.jumpContentTarget),null!==this.jumpContentLink&&this.jumpContentLinkFallback.setAttribute("tabindex","-1"),null===this.jumpContentTarget?this.jumpContentTarget=document.querySelector(this.selectors.jumpContentTargetFallback):this.jumpContentLinkFallback.href=this.selectors.jumpContentTarget,this.bindEvents(),this.triggerAlert())},bindEvents:function(){var sitemapCallback=this.btnCallback(this.toggleSitemap);this.sitemapLinkEl.addEventListener("click",sitemapCallback,!1),this.sitemapLinkEl.addEventListener("keypress",sitemapCallback,!1);var closeBtnCallback=this.btnCallback(this.closeSitemap);this.sitemapCloseEl.addEventListener("click",closeBtnCallback,!1),this.sitemapCloseEl.addEventListener("keypress",closeBtnCallback,!1);var onFocusCallback=this.makeCallback(this.onFocused);this.sitemapCloseEl.addEventListener("focusin",onFocusCallback,!1);var jumpContentCallback=this.makeCallback(this.jumpToContent);this.jumpContentLinkFallback.addEventListener("click",jumpContentCallback,!1);var sitemapDialogCallback=this.tabCallback(this.tabThroughSitemap);this.containerEl.addEventListener("keydown",sitemapDialogCallback,!1);var headerTabCallback=this.tabCallback(this.tabThroughHeader);this.headerEl.addEventListener("keydown",headerTabCallback,!1);var mobileCategoryCallback=this.makeCallback(this.toggleMobileCategory);[].forEach.call(this.wrapperEl.querySelectorAll(this.selectors.mobileCategories),function(element){element.addEventListener("click",mobileCategoryCallback,!1)})},onFocused:function(event){-1===this.tabbableHeaderLinks.indexOf(event.relatedTarget)&&-1===this.tabbableSitemapLinks.indexOf(event.relatedTarget)&&this.tabbableHeaderLinks[this.tabbableHeaderLinks.length-1].focus()},jumpToContent:function(){this.jumpContentTarget.focus()},btnCallback:function(callback){var that=this;return function(event){"click"===event.type?callback.call(that,event):"keypress"!==event.type||13!==event.keyCode&&32!==event.keyCode||callback.call(that,event)}},tabCallback:function(callback){var that=this;return function(event){9!==event.keyCode&&27!==event.keyCode||callback.call(that,event)}},makeCallback:function(callback){var that=this;return function(event){callback.call(that,event)}},toggleClass:function(element){var reg=new RegExp("(\\s|^)"+this.openClass+"(\\s|$)");element.className.match(reg)?element.className=element.className.replace(reg," "):element.className+=" "+this.openClass},toggleSitemap:function(event){event.preventDefault(),event.stopImmediatePropagation(),this.sitemapOpen=!this.sitemapOpen,this.sitemapLinkEl.setAttribute("aria-expanded",this.sitemapOpen),this.toggleClass(this.wrapperEl),this.sitemapOpen?this.containerEl.focus():this.sitemapLinkEl.focus()},tabThroughHeader:function(event){if(9===event.keyCode){var index=this.tabbableHeaderLinks.indexOf(event.target);event.shiftKey?this.sitemapOpen&&event.target===this.sitemapLinkSibEl&&(event.preventDefault(),event.stopImmediatePropagation(),this.sitemapCloseEl.focus()):this.sitemapOpen&&event.target===this.sitemapLinkEl?this.containerEl.focus():index===this.tabbableHeaderLinks.length-1&&this.sitemapCloseEl.focus()}},tabThroughSitemap:function(event){if(9===event.keyCode){var index=this.tabbableSitemapLinks.indexOf(event.target);(index===this.tabbableSitemapLinks.length-1&&!event.shiftKey||0===index&&event.shiftKey)&&(event.preventDefault(),event.stopImmediatePropagation(),0===index&&event.shiftKey?this.sitemapLinkEl.focus():this.sitemapLinkSibEl.focus())}else 27===event.keyCode&&this.closeSitemap(event)},closeSitemap:function(event,target){event.preventDefault(),event.stopImmediatePropagation();var target_=target||this.sitemapLinkEl;this.sitemapOpen&&(this.sitemapOpen=!this.sitemapOpen,this.sitemapLinkEl.setAttribute("aria-expanded",this.sitemapOpen),this.toggleClass(this.wrapperEl),target_.focus())},getNextSibling:function(nodeEl){for(var nextNodeEl=nodeEl;nextNodeEl=nodeEl.nextSibling;)if(1===nextNodeEl.nodeType)return nextNodeEl;return null},toggleMobileCategory:function(event){event.preventDefault(),this.toggleClass(event.target.parentNode)},triggerAlert:function(){var evt=document.createEvent("Events");evt.initEvent(this.alertEvent,!0,!0),document.dispatchEvent(evt)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){That.init()},!1):That.init()}(),function(){"use strict";var Alert={selectors:{that:"bb-that",alert:".bb-that__alert",alertClose:".bb-that__alert--close",alertActive:"bb-that__alert--active",dataEndpoint:"data-alert-service"},logs:{invalidTHAT:"THAT was not rendered correctly. ",noEndpoint:"Alert retrieval endpoint not set. ",noAlert:"There are no alerts to display at the moment ",parsingError:"There was an error when parsing the alert response ",invalidResponse:"There was an error when retrieving the alert ",alertClose:"The alert has been closed. ",alertSeen:"The alert has already been seen and closed."},cookieName:"bloomberg.that.alert",cookieDuration:1,alertEvent:"bloomberg.that.alert",endpoint:"",tophat:null,init:function(){this.validateTHAT()&&this.retrieveAlert()},validateTHAT:function(){var $valid=!1;return this.tophat=document.querySelector("div#"+this.selectors.that),this.tophat?(this.endpoint=this.tophat.getAttribute(this.selectors.dataEndpoint),this.endpoint?$valid=!0:this.log(!0,this.logs.noEndpoint)):this.log(!0,this.logs.invalidTHAT),$valid},retrieveAlert:function(){var xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState===XMLHttpRequest.DONE)if(200===xmlhttp.status)try{var $response=JSON.parse(xmlhttp.responseText);$response.hasOwnProperty("alerts")&&Array.isArray($response.alerts)&&0<$response.alerts.length&&Alert.renderAlert($response.alerts[0])}catch(e){Alert.log(!0,Alert.logs.parsingError,e)}else Alert.log(!0,Alert.logs.invalidResponse,xmlhttp.status)},xmlhttp.open("GET",this.endpoint,!0),xmlhttp.send()},renderAlert:function(alert){this.getCookie(this.cookieName)?this.log(!1,this.logs.alertSeen):(this.tophat.insertAdjacentHTML("afterbegin",alert),document.querySelector(this.selectors.alert).classList.add(this.selectors.alertActive),this.bindClose())},bindClose:function(){document.querySelector(this.selectors.alertClose).addEventListener("click",function(){Alert.tophat.removeChild(document.querySelector(Alert.selectors.alert)),Alert.setCookie(Alert.cookieName,!0,Alert.cookieDuration),Alert.log(!1,Alert.logs.alertClose)})},setCookie:function(name,value,xdays){var d=new Date;d.setTime(d.getTime()+864e5*xdays),document.cookie=name+"="+value+";path=/;expires="+d.toUTCString()},getCookie:function(name){var v=document.cookie.match("(^|;) ?"+name+"=([^;]*)(;|$)");return v?v[2]:null},deleteCookie:function(name){this.setCookie(name,"",-1)},log:function(error,message,extra){error?window.console.error(this.alertEvent,{message:message,extra:extra}):window.console.log(this.alertEvent,{message:message,extra:extra})}};document.addEventListener(Alert.alertEvent,function(){Alert.init()})}();
